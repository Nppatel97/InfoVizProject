<!DOCTYPE html>
<html>

<head>
    <script src="https://cdn.zingchart.com/zingchart.min.js"></script>
    <script>
        zingchart.MODULESDIR = "https://cdn.zingchart.com/modules/";
        ZC.LICENSE = ["569d52cefae586f634c54f86dc99e6a9", "ee6b7db5b51705a13dc2339db3edaf6d"];
    </script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <style>
        html,
        body,
        #myChart {
            height: 100%;
            width: 100%;
        }
        /* <!-- select {text-align: center;}		 --> */
    </style>
</head>

<style>
    .pad {
        margin-left: 30px;
        font-family: "helvetica";
    }
</style>

<style>
    .pad2 {
        font-family: "helvetica";
    }
</style>


<body>

    <div align="center">
        <font face="helvetica" size=6>Symphonia</font>
    </div>
    <div align="center">
        <font face="helvetica" size=4>What made music popular in 2017?</font>
    </div>



    <div class="pad" align="center"><select id="song" onChange="updateSong1(this);"></select>
        <select id="song2" onChange="updateSong2(this);"></select></div>
    <br>
    <div class="pad2" align="center"><input id="update" type="button" value="Find Something Similar" onclick="findSomethingSimilar();" /></div>

    <div id='myChart'></div>
    <script>
        var dictionary = {};

        var max_duration = 0;
        var min_duration = Number.POSITIVE_INFINITY;

        var max_tempo = 0;
        var min_tempo = Number.POSITIVE_INFINITY;

        var data;

        var first_song_name_and_artist;

        d3.csv("song_data.csv", function(error, data) {
            if (error) throw error;
            // <!-- console.log (data); -->

            var catOptions1 = "<option>Select a Song</option>";
            var catOptions2 = "<option>Select a Song to Compare</option>";
            for (var row in data) {
                var list = [];

                for (var item in data[row]) {
                    // <!-- console.log (data[row][item]) -->
                    list.push(data[row][item]);
                    // <!-- console.log ('oi'); -->
                    // <!-- console.log (list); -->
                }
                // <!-- console.log (list[1]); -->
                dictionary[list[1]] = list;

                catOptions1 += "<option>" + data[row]['name'] + "</option>";
                catOptions2 += "<option>" + data[row]['name'] + "</option>";

            }
            document.getElementById("song").innerHTML = catOptions1;
            document.getElementById("song2").innerHTML = catOptions2;
        });



        //console.log (data);

        var myConfig = {
            type: 'radar',
            legend: {},
            title: {
                text: ""
            },
            // <!-- refresh: { -->
            // <!-- interval: 1}, -->
            // <!-- csv: { -->
            // <!-- url: './zingchart/song_data.csv', -->
            // <!-- "vertical-labels":true, -->
            // <!-- "smart-scales":true, -->
            // <!-- "horizontal-labels":true -->
            //   <!-- }, -->

            plot: {
                aspect: 'area',
                animation: {
                    effect: 3,
                    sequence: 1,
                    speed: 700
                }
            },
            scaleV: {
                values: "0:100:5",
                visible: true
            },
            scaleK: {
                // <!-- values: '0:11:1', -->
                values: '0:9:1',
                // <!-- labels: ['danceability', 'energy', 'key', 'loudness', 'mode', 'speechiness', 'acousticness', 'instrumentalness', 'liveness', 'valence', 'duration_ms', 'time_signature'], -->
                // <!-- labels: ['danceability', 'energy', 'key', 'loudness', 'mode', 'speechiness', 'acousticness', 'instrumentalness', 'liveness', 'valence', 'tempo', 'duration_ms', 'time_signature'], -->
                labels: ['danceability', 'energy', 'loudness', 'speechiness', 'acousticness', 'instrumentalness', 'liveness', 'valence', 'tempo', 'duration_ms'],
                item: {
                    fontColor: '#607D8B',
                    backgroundColor: "white",
                    borderColor: "#aeaeae",
                    borderWidth: 1,
                    padding: '5 10',
                    borderRadius: 10
                },
                refLine: {
                    lineColor: '#c10000'
                },
                tick: {
                    lineColor: '#59869c',
                    lineWidth: 2,
                    lineStyle: 'dotted',
                    size: 20
                },
                guide: {
                    lineColor: "#607D8B",
                    lineStyle: 'solid',
                    alpha: 0.3,
                    backgroundColor: "#c5c5c5 #718eb4"
                }
            },
            series: [{
                // <!-- values: [100, 90, 80, 70, 60, 50, 100, 50, 60, 70, 80, 90, 100], -->
                // <!-- text: 'farm' -->
                backgroundColor: "#377eb8",
                legendText: "Song 1"
            }, {
                // <!-- values: [20, 20, 54, 41, 41, 35], -->
                // <!-- lineColor: '#53a534', -->
                backgroundColor: '#689F38',
                legendText: "Song 2"
            }]
        };

        zingchart.render({
            id: 'myChart',
            data: myConfig,
            height: "100%",
            width: "100%"
        });

        /**
         * After 5 seconds update the url/refresh
         * the graph using setdata
         */
        // <!-- setTimeout(function() { -->
        //   <!-- myConfig.csv.url = './zingchart/song_data.csv' -->

        // ZingChart API setdata will upload a new JSON packet
        // to the chart
        //   <!-- zingchart.exec('myChart', 'setdata', { -->
        // <!-- data: myConfig -->
        //   <!-- }); -->
        // <!-- }, 5000); -->

        /**
         * Every minute refresh the chart
         */
        // <!-- setInterval(function() { -->
        //   <!-- zingchart.exec('myChart', 'reload'); -->
        // <!-- }, 5000); -->


        function updateSong1(selection) {

            // <!-- get selection -->
            var song_to_select = selection.options[selection.selectedIndex].text;

            // <!-- update min and max duration once -->
            if (max_duration == 0) {

                for (var key in dictionary) {
                    if (dictionary[key][14] > max_duration && dictionary[key][14] != "duration_ms") {
                        max_duration = dictionary[key][14]
                    }

                    if (dictionary[key][14] < min_duration && dictionary[key][14] != "duration_ms") {
                        min_duration = dictionary[key][14]
                    }
                    if (parseFloat(dictionary[key][13]) > max_tempo && dictionary[key][13] != "tempo") {
                        max_tempo = parseFloat(dictionary[key][13])
                    }

                    if (parseFloat(dictionary[key][13]) < min_tempo && dictionary[key][13] != "tempo") {
                        min_tempo = parseFloat(dictionary[key][13])
                    }
                }
            }

            console.log(max_tempo);
            console.log(min_tempo);

            if (song_to_select != "Select a Song") {
                // <!-- update chart to reflect selected name and artist -->

                first_song_name_and_artist = dictionary[song_to_select][1] + ' by ' + dictionary[song_to_select][2];
                myConfig.title.text = first_song_name_and_artist;

                var temp = myConfig.series.pop();

                // <!-- id = [0], name = [1], artist = [2] -->
                myConfig.series = [{
                    values: [
                        // <!-- danceability -->
                        dictionary[song_to_select][3] * 100,
                        // <!-- energy -->
                        dictionary[song_to_select][4] * 100,
                        // <!-- key: normalized over 12 intervals -->
                        // <!-- dictionary[song_to_select][5] / 12 * 100,  -->
                        // <!-- loudness: look at normalizing a % -->
                        parseFloat(dictionary[song_to_select][6]) + 100,
                        // <!-- mode: only over 0 or 1 -->
                        // <!-- dictionary[song_to_select][7]*100,  -->
                        // <!-- speechiness -->
                        dictionary[song_to_select][8] * 100,
                        // <!-- acousticness -->
                        dictionary[song_to_select][9] * 100,
                        // <!-- instrumentalness -->
                        dictionary[song_to_select][10] * 100,
                        // <!-- liveness -->
                        dictionary[song_to_select][11] * 100,
                        // <!-- valence -->
                        dictionary[song_to_select][12] * 100,
                        // <!-- tempo: look at normalizing -->
                        parseFloat(dictionary[song_to_select][13]) / max_tempo * 100,
                        // <!-- duration: converted from millisecs to secs -->
                        (dictionary[song_to_select][14] - min_duration) / (max_duration - min_duration) * 100,
                        // <!-- dictionary[song_to_select][14]/max_duration * 100, -->
                        // <!-- time_signature: normalized over [0,4] -->
                        // <!-- dictionary[song_to_select][15] / 4 * 100,  -->
                    ],
                    legendText: "Song 1"
                        // <!-- },  -->
                        // <!-- { -->
                        // <!-- values: [20, 20, 54, 41, 41, 35], -->
                        // <!-- lineColor: '#53a534', -->
                        // <!-- backgroundColor: '#689F38' -->
                }];

                myConfig.series.push(temp);
                // <!-- console.log(dictionary[song_to_select][13]); -->
                // <!-- console.log(typeof dictionary[song_to_select][13]) -->

            } else {
                // <!-- set to default -->
                myConfig.title.text = "";
                myConfig.series = [{
                    values: []
                }];
            }

            zingchart.render({
                id: 'myChart',
                data: myConfig,
                height: '100%',
                width: '100%'
            });

        }

        function updateSong2(selection) {

            // <!-- get selection -->
            var song_to_select = selection.options[selection.selectedIndex].text;

            // <!-- update min and max duration once -->
            if (max_duration == 0) {

                for (var key in dictionary) {
                    if (dictionary[key][14] > max_duration && dictionary[key][14] != "duration_ms") {
                        max_duration = dictionary[key][14]
                    }

                    if (dictionary[key][14] < min_duration && dictionary[key][14] != "duration_ms") {
                        min_duration = dictionary[key][14]
                    }
                    if (parseFloat(dictionary[key][13]) > max_tempo && dictionary[key][13] != "tempo") {
                        max_tempo = parseFloat(dictionary[key][13])
                    }

                    if (parseFloat(dictionary[key][13]) < min_tempo && dictionary[key][13] != "tempo") {
                        min_tempo = parseFloat(dictionary[key][13])
                    }
                }
            }



            if (song_to_select != "Select a Song to Compare") {
                // <!-- update chart to reflect selected name and artist -->
                // <!-- how to update the title for comparisons... -->
                myConfig.title.text = first_song_name_and_artist + '\ncompared with\n' + dictionary[song_to_select][1] + ' by ' + dictionary[song_to_select][2];
                if (myConfig.series.length != 1) {
                    myConfig.series = myConfig.series.slice(0, -1);
                }

                // <!-- id = [0], name = [1], artist = [2] -->
                myConfig.series.push({
                    values: [
                        // <!-- danceability -->
                        dictionary[song_to_select][3] * 100,
                        // <!-- energy -->
                        dictionary[song_to_select][4] * 100,
                        // <!-- key: normalized over 12 intervals -->
                        // <!-- dictionary[song_to_select][5] / 12 * 100,  -->
                        // <!-- loudness: look at normalizing a % -->
                        parseFloat(dictionary[song_to_select][6]) + 100,
                        // <!-- mode: only over 0 or 1 -->
                        // <!-- dictionary[song_to_select][7]*100,  -->
                        // <!-- speechiness -->
                        dictionary[song_to_select][8] * 100,
                        // <!-- acousticness -->
                        dictionary[song_to_select][9] * 100,
                        // <!-- instrumentalness -->
                        dictionary[song_to_select][10] * 100,
                        // <!-- liveness -->
                        dictionary[song_to_select][11] * 100,
                        // <!-- valence -->
                        dictionary[song_to_select][12] * 100,
                        // <!-- tempo: look at normalizing -->
                        parseFloat(dictionary[song_to_select][13]) / max_tempo * 100,
                        // <!-- duration: converted from millisecs to secs -->
                        (dictionary[song_to_select][14] - min_duration) / (max_duration - min_duration) * 100,
                        // <!-- dictionary[song_to_select][14]/max_duration * 100, -->
                    ],
                    legendText: "Song 2"
                });

                console.log(dictionary[song_to_select][13]);
                console.log(typeof dictionary[song_to_select][13])

            } else {
                // <!-- set to default -->
                myConfig.title.text = "";
                myConfig.series = myConfig.series.slice(0, -1);
            }

            zingchart.render({
                id: 'myChart',
                data: myConfig,
                height: '100%',
                width: '100%'
            });

        }
    </script>
</body>

</html>